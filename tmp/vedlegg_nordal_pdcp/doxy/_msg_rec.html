<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>

<title>&quot;Msg Reception&quot;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logoPDCP.png"/></td>
  
  
  
   
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">index</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">"Msg Reception" </div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="rec_1"></a>
HAL aspects</h2>
<p>Block diagram of message receiving in HAL in relation to HLL was presented in the picture below. </p>
<div class="image">
<img src="../doxy-src/msgReceiving.png" alt="msgReceiving.png"/>
</div>
<p>Mechanism of message reception starts inside of CAN controller. When CAN controller of particular node receives a message, firstly checks correctness of ID (placed within arbitration field) using MASK and FILTER. MCP2515 chip contains up to 7 filters, however only one is used for purpose of PDCP. Afterwards, mechanism of external interrupt is triggered by pulling external interrupt pin of microcontroller to low. Microcontroller is configured to call interrupt routine whenever falling edge on the pin is noticed. Within handler designed software checks source of interrupt - ready transmitting buffer(s), full receiving buffer(s) or some error. Information about all events is saved in special flags. <br/>
<b> Moreover every full receiving buffer interrupt triggers software interrupt by calling function <a class="el" href="functions_8c.html#ade364318c9fccf1c85460152a37366cf" title="Function to trigger software interrupt.">triggerSoftwareInterrupt()</a> with argument: TRIGGER_RECEIVING.</b> Because interrupts are swiched-off within interrupt handlers, so just after completing interrupt from CAN controller, message should be handled.<br/>
 Firstly, function <a class="el" href="group___a_p_i.html#gabc2439d6188d2b346e55f057d6afb86c">hll_msg_alloc()</a> is called to get free pointer for the received message. Secondly, transfer of id, message length and data is executed using function <a class="el" href="functions_8c.html#aef465a9252f48f0c04ef98d5c34d0000" title="Function to transmit data between MCU and MCP2515.">mcp2515TransmitData()</a> and inside <a class="el" href="functions_8c.html#ab8dd365a6eb65e1e33b806fdae617a42" title="SPI Transmit Data.">transmitSpi()</a>. Just after transfer, individual elements of the message are assigned to particular fields pointed by mentioned pointer. This solution allows to avoid having buffers inside of HAL and increase speed of data exchange between HAL and HLL of PDCP and upper layers. If data transfer is completed, HAL calls function <a class="el" href="group___a_p_i.html#gadb88ff322b06af05fa9a49ab74a4719b">hll_msg_commit()</a> with the pointer as argument, which allows HLL to process data. Just after that clearInterruptFlag() is called with the flag of the receiving buffer which received the message. From the moment buffer is allowed to overwrite internal receiving buffer.<br/>
 Message is processed in HLL. <br/>
<br/>
</p>
<h2><a class="anchor" id="rec_2"></a>
HLL aspects</h2>
<p>To be filled by AN. <br/>
<br/>
<br/>
 </p>
</div></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 18 2012 05:45:07 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
